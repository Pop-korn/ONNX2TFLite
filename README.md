# ONNX to TFLite convertor
## **Work In Progress**
Open project to **directly** convert models from the *.onnx* to *.tflite* format.

To use the converter, run **pyton onnx2tflite <input-model.onnx> <output-model.tflite>**. For example: *python onnx2tflite data/onnx/bvlcalexnet-12.onnx test/alexnet.tflite*

Verified models:

* Alexnet (https://github.com/onnx/models/blob/main/vision/classification/alexnet/model/bvlcalexnet-12.onnx)
* TinyYOLO (https://github.com/onnx/models/blob/main/vision/object_detection_segmentation/tiny-yolov2/model/tinyyolov2-8.onnx)
* DUC (https://github.com/onnx/models/blob/main/vision/object_detection_segmentation/duc/model/ResNet101-DUC-12.onnx)

Only a few operators are supported at the moment. Project should be in a usable state by June 2023.

The only python packages required for model conversion are *numpy*, *flatbuffers* and *protobuf*. Others are used just for testing. To install all used python packages, run *make install* in the root directory. There is a requirement confilct between tensorflow and onnx over protobuf version. This program doesn't require that part of tensorflow functionality, so if there is a problem during instalation, run **pip install onnx==1.13.0**. Conversion testing should now work.

Project comes with *ONNX* and *TFLite* schemas pre-installed and libraries pre-compiled. If you want, you can delete the *data/schemas* and *lib* directories and run *make regenerate-lib*  in the root directory to get the schemas and complie them yourself. THIS MAT CAUSE *make test* TO NOT WORK!

---
## Structure
The entry point of the program is the *main.py* file in the root directory. To run the program use Makefile in the root directory. A *.tflite* model will be generated in the **/test** directory.

The **/data** directory contains pre-trained models, tensor values, input images for inference testing and schemas. Some models are not included on GitHub because of size restrictions.


The code in the **/src** diroctory is split into multiple subdirectories.

* **/src/generator** contains classes used for internal representation of a TFLite model and for subsequent *.tflie* file generation.

* **/src/parser** conatins classes used for internal representation of an ONNX model and for loading it's data from a *.onnx* file.

* **/src/convertor** contains files for converting from the *parser* object model to the *generator* model.

The **/lib** directory contains files generated by compiling TFLite an ONNX schemas. They provide a low level interface for parsing a *.onnx* file and for generating a *.tflite* file.

* **/lib/tflite** is a library generated from the */data/schemas/tflite/schema.bfs* file, using the *flatc -p ../data/schema.fbs* command.

* **/lib/onnx** is a library generated from the files in the */data/schemas/onnx/* directory.

The **/test** directory is used for analyzing the generated *.tflite* models.

___

## License

This software is covered by the MIT license.
